"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createFileComment = exports.createReviewComment = exports.formatReviewBody = exports.extractPRInfo = void 0;
// Pure function to extract PR info
const extractPRInfo = (pr) => {
    return {
        number: pr.number,
        headSha: pr.head.sha,
        baseSha: pr.base.sha,
        headRef: pr.head.ref,
        baseRef: pr.base.ref,
        author: pr.user.login,
    };
};
exports.extractPRInfo = extractPRInfo;
// Pure function to format review body with PR summary
const formatReviewBody = (model, totalTokens, commentCount, prInfo, costInfo) => {
    let summary = `## ðŸ°âš¡ Bad Buggy\n\n`;
    // Add PR summary if provided
    if (prInfo) {
        summary += `### ðŸ“‹ Pull Request Summary\n\n`;
        summary += `**Title:** ${prInfo.title}\n`;
        summary += `**Author:** @${prInfo.author}\n`;
        summary += `**Files Changed:** ${prInfo.filesChanged.length} files\n`;
        summary += `**Changes:** +${prInfo.additions} -${prInfo.deletions}\n`;
        if (prInfo.description && prInfo.description.trim()) {
            summary += `**Description:** ${prInfo.description.trim()}\n`;
        }
        summary += `\n**Modified Files:**\n`;
        prInfo.filesChanged.slice(0, 10).forEach((file) => {
            summary += `- \`${file}\`\n`;
        });
        if (prInfo.filesChanged.length > 10) {
            summary += `- ... and ${prInfo.filesChanged.length - 10} more files\n`;
        }
        summary += `\n---\n\n`;
    }
    // Add review details
    const modelInfo = `**Model:** ${model}`;
    const tokenInfo = `**Tokens:** ${totalTokens.input + totalTokens.output} (${totalTokens.input} input, ${totalTokens.output} output)`;
    // Add cost information if available
    let costSection = '';
    if (costInfo) {
        const reviewsPerDollar = costInfo.totalCost > 0 ? Math.floor(1 / costInfo.totalCost) : 0;
        costSection = `**Total cost:** $${costInfo.totalCost.toFixed(4)} (equal to ${reviewsPerDollar} reviews per dollar)\n`;
    }
    const commentInfo = `**Comments:** ${commentCount}`;
    summary += `### ðŸ” Review Details\n\n${modelInfo}\n${costSection}${tokenInfo}\n${commentInfo}\n\n---\n\n*This review was generated by Bad Buggy code reviewer.*`;
    return summary;
};
exports.formatReviewBody = formatReviewBody;
// Pure function to create review comment (diff-based)
const createReviewComment = (path, line, body, end_line) => {
    return {
        path,
        line,
        body,
        end_line,
        commentType: 'diff',
    };
};
exports.createReviewComment = createReviewComment;
// Pure function to create file-level comment
const createFileComment = (path, body) => {
    return {
        path,
        body,
        commentType: 'file',
    };
};
exports.createFileComment = createFileComment;
//# sourceMappingURL=github.js.map